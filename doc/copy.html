<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>COPY | Npgsql Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="COPY | Npgsql Documentation ">
      
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/npgsql/doc/blob/main/conceptual/Npgsql/copy.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../img/logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="copy">COPY</h1>

<p>PostgreSQL has a feature allowing efficient bulk import or export of data to and from a table. This is usually a much faster way of getting data in and out of a table than using INSERT and SELECT. See documentation for the <a href="http://www.postgresql.org/docs/current/static/sql-copy.html">COPY command</a> for more details.</p>
<p>Npgsql supports three COPY operation modes: binary, text and raw binary.</p>
<h2 id="binary-copy">Binary COPY</h2>
<p>This mode uses the efficient PostgreSQL binary format to transfer data in and out of the database. The user uses an API to read and write rows and fields, which Npgsql decodes and encodes. When you've finished, you must call <code>Complete()</code> to save the data; not doing so will cause the COPY operation to be rolled back when the writer is disposed (this behavior is important in case an exception is thrown).</p>
<div class="WARNING">
<h5>Warning</h5>
<p>It is the your responsibility to read and write the correct type! If you use COPY to write an int32 into a string field you may get an exception, or worse, silent data corruption. It is also highly recommended to use the overload of <code>Write()</code> which accepts an <code>NpgsqlDbType</code>, allowing you to unambiguously specify exactly what type you want to write. Test your code thoroughly.</p>
</div>
<pre><code class="lang-c#">// Import two columns to table data
using (var writer = conn.BeginBinaryImport(&quot;COPY data (field_text, field_int2) FROM STDIN (FORMAT BINARY)&quot;))
{
    writer.StartRow();
    writer.Write(&quot;Hello&quot;);
    writer.Write(8, NpgsqlDbType.Smallint);

    writer.StartRow();
    writer.Write(&quot;Goodbye&quot;);
    writer.WriteNull();

    writer.Complete();
}

// Export two columns to table data
using (var reader = Conn.BeginBinaryExport(&quot;COPY data (field_text, field_int2) TO STDOUT (FORMAT BINARY)&quot;))
{
    reader.StartRow();
    Console.WriteLine(reader.Read&lt;string&gt;());
    Console.WriteLine(reader.Read&lt;int&gt;(NpgsqlDbType.Smallint));

    reader.StartRow();
    reader.Skip();
    Console.WriteLine(reader.IsNull);   // Null check doesn't consume the column
    Console.WriteLine(reader.Read&lt;int&gt;());

    reader.StartRow();    // Last StartRow() returns -1 to indicate end of data
}
</code></pre>
<h2 id="text-copy">Text COPY</h2>
<p>This mode uses the PostgreSQL text or csv format to transfer data in and out of the database. It is the user's responsibility to format the text or CSV appropriately, Npgsql simply provides a TextReader or Writer. This mode is less efficient than binary copy, and is suitable mainly if you already have the data in a CSV or compatible text format and don't care about performance.</p>
<pre><code class="lang-c#">using (var writer = conn.BeginTextImport(&quot;COPY data (field_text, field_int4) FROM STDIN&quot;)) {
    writer.Write(&quot;HELLO\t1\n&quot;);
    writer.Write(&quot;GOODBYE\t2\n&quot;);
}

using (var reader = conn.BeginTextExport(&quot;COPY data (field_text, field_int4) TO STDOUT&quot;)) {
    Console.WriteLine(reader.ReadLine());
    Console.WriteLine(reader.ReadLine());
}
</code></pre>
<h2 id="raw-binary-copy">Raw Binary COPY</h2>
<p>In this mode, data transfer is binary, but Npgsql does no encoding or decoding whatsoever - data is exposed as a raw .NET Stream. This mode makes sense only for bulk data and restore a table: the table is saved as a blob, which can later be restored. If you need to actually make sense of the data, you should be using regular binary mode instead (not raw).</p>
<p>Example:</p>
<pre><code class="lang-c#">int len;
var data = new byte[10000];
// Export table1 to data array
using (var inStream = conn.BeginRawBinaryCopy(&quot;COPY table1 TO STDOUT (FORMAT BINARY)&quot;)) {
    // We assume the data will fit in 10000 bytes, in real usage you would read repeatedly, writine to a file.
    len = inStream.Read(data, 0, data.Length);
}

// Import data array into table2
using (var outStream = conn.BeginRawBinaryCopy(&quot;COPY table2 FROM STDIN (FORMAT BINARY)&quot;)) {
    outStream.Write(data, 0, len);
}
</code></pre>
<h2 id="cancel">Cancel</h2>
<p>Import operations can be cancelled at any time by disposing <code>NpgsqlBinaryImporter</code> without calling <code>Complete()</code> on it. Export operations can be cancelled as well, by calling <code>Cancel()</code>.</p>
<h2 id="other">Other</h2>
<p>See the CopyTests.cs test fixture for more usage samples.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/npgsql/doc/blob/main/conceptual/Npgsql/copy.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          © Copyright 2024 The Npgsql Development Team
        </div>
      </div>
    </footer>
  </body>
</html>
