<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>9.0 Release Notes | Npgsql Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="9.0 Release Notes | Npgsql Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/npgsql/doc/blob/main/conceptual/EFCore.PG/release-notes/9.0.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../img/logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="90-release-notes">9.0 Release Notes</h1>

<p>Npgsql.EntityFrameworkCore.PostgreSQL version 9.0 is under development; previews are available on <a href="https://www.nuget.org/packages/Npgsql.EntityFrameworkCore.PostgreSQL">nuget.org</a>.</p>
<div class="NOTE">
<h5>Note</h5>
<p>The following release notes and breaking changes are partial. More will be added nearer to the 9.0 final release.</p>
</div>
<h2 id="improved-unified-configuration-experience">Improved, unified configuration experience</h2>
<p>The Npgsql EF provider is built on top of the lower-level Npgsql ADO.NET provider; the configuration interface between these two layers was less than ideal, and configuration been more difficult than it should have been. For version 9.0, the configuration experience has been considerably improved.</p>
<p>Since version 7, the Npgsql ADO.NET provider has been moving to <a href="../../doc/basic-usage.html#data-source">NpgsqlDataSource</a> as the preferred way of configuration connections and obtaining them. At the EF level, it has been possible to pass an NpgsqlDataSource instance to <code>UseNpgsql()</code>; but this required that the user separately configure a data source and manage it. In addition, features such as  plugins and enums require support from both the EF and ADO.NET layers, forcing users to perform multiple setup actions at the different layers.</p>
<p>With version 9, <code>UseNpgsql()</code> becomes a single point for configuration, for both the EF and ADO.NET levels. EF can now internally set up an NpgsqlDataSource, automatically applying all the necessary configuration to it, and also exposes an API to allow users to apply arbitrary configuration to it as well:</p>
<pre><code class="lang-csharp">builder.Services.AddDbContextPool&lt;BloggingContext&gt;(opt =&gt;
    opt.UseNpgsql(
        builder.Configuration.GetConnectionString(&quot;BloggingContext&quot;),
        o =&gt; o
            .SetPostgresVersion(13, 0)
            .UseNodaTime()
            .MapEnum&lt;Mood&gt;(&quot;mood&quot;)
            .ConfigureDataSource(dataSourceBuilder =&gt; dataSourceBuilder.UseClientCertificate(certificate))));
</code></pre>
<p>In the above code, the following configuration gestures are performed:</p>
<ol>
<li><code>SetPostgresVersion()</code> is an EF-only option to produce SQL for PostgreSQL version 13 (avoiding newer incompatible features)</li>
<li><code>UseNodaTime()</code>, adds a plugin allowing use of NodaTime for date/time type mapping. This also requires an ADO.NET NodaTime plugin which needed to be configured separately, but this is now done automatically.</li>
<li><code>MapEnum()</code> maps a .NET enum type. Like <code>UseNodaTime()</code>, this also used to require a separate ADO.NET configuration gesture, but is now done automatically. As an added bonus, doing this now also adds the enum to the model, causing the enum to be created in the database via EF's migrations.</li>
<li><code>ConfigureDataSource()</code> exposes an NpgsqlDataSourceBuilder, which you can use to configure arbitrary ADO.NET options. In this example, the certificate is defined for the TLS authentication process.</li>
</ol>
<p>For more information, see the <a href="../index.html">getting started docs</a>.</p>
<h3 id="improved-configuration-for-enums-and-plugins">Improved configuration for enums and plugins</h3>
<p>Previously, configuration around enums and plugins (NodaTime, NetTopologySuite) was complicated, requiring multiple setup actions at both the EF and the lower-level Npgsql layers. EF 9.0 improves the configuration story, allowing you to configure enums and plugins via a single EF gesture:</p>
<pre><code class="lang-csharp">builder.Services.AddPooledDbContext&lt;MyContext&gt;(options =&gt; options.UseNpgsql(
    &quot;&lt;connection string&gt;&quot;,
    o =&gt; o.MapEnum&lt;Mood&gt;(&quot;mood&quot;)));
</code></pre>
<p>This takes care of everything - EF configuration, lower-level Npgsql configuration and even the addition of the enum to the EF model, which ensures that the enum is created in the database in EF migrations.</p>
<p>See the <a href="../mapping/enum.html">enum</a>, <a href="../mapping/nodatime.html">NodaTime</a> and <a href="../mapping/nts.html">NetTopologySuite</a> documentation for more details.</p>
<h2 id="uuidv7-guids-are-generated-by-default">UUIDv7 GUIDs are generated by default</h2>
<p>When your entity types have a <code>Guid</code> key, EF Core by default generates key values for new entities client-side - in .NET - before inserting those entity types to the database; this can be better for performance in some situations. Before version 9.0, the provider generated random GUIDs (version 4) by calling the .NET <a href="https://learn.microsoft.com/en-us/dotnet/api/system.guid.newguid?view=net-8.0#system-guid-newguid"><code>Guid.NewGuid()</code></a> function. Unfortunately, random GUIDs aren't ideal for database indexing and can cause performance issues.</p>
<p>Version 9.0 of the provider now generates the recently standardized version 7 GUIDs, which is a sequential GUID type that's more appropriate for database indexes and improves their performance. This new behavior is on by default and takes effect simply by upgrading the provider version.</p>
<p>See <a href="https://www.cybertec-postgresql.com/en/unexpected-downsides-of-uuid-keys-in-postgresql">this post</a> for more details and performance numbers on random vs. sequential GUIDs.</p>
<p>Thanks to <a href="https://github.com/ChrisJollyAU">@ChrisJollyAU</a> and <a href="https://github.com/Timovzl">@Timovzl</a> for contributing this improvement!</p>
<h2 id="breaking-changes">Breaking changes</h2>
<h3 id="enum-mappings-must-now-be-configured-at-the-ef-level">Enum mappings must now be configured at the EF level</h3>
<p>Previously, enum configuration involved mapping the enum at the lower-level Npgsql layer (either via <code>NpgsqlDataSourceBuilder.MapEnum</code> or via <code>NpgsqlConnection.GlobalTypeMapper.MapEnum</code>); the EF provider automatically picked this configuration up for the EF-level setup. Unfortunately, this design created numerous issues and bugs.</p>
<p>As part of the improved enum configuration story in version 9.0 (<a href="#improved-configuration-for-enums-and-plugins">see above</a>), enums must now be configured at the EF level; although this is a breaking change for existing applications, it usually results in simplified setup code and fixes various bugs and problematic behavior.</p>
<p>If your application calls <code>UseNpgsql</code> with a simple connection string (rather than an NpgsqlDataSource), it simply needs to add a <code>MapEnum</code> call there:</p>
<pre><code class="lang-csharp">builder.Services.AddDbContext&lt;MyContext&gt;(options =&gt; options.UseNpgsql(
    &quot;&lt;connection string&gt;&quot;,
    o =&gt; o.MapEnum&lt;Mood&gt;(&quot;mood&quot;)));
</code></pre>
<p>All other setup code - the <code>MapEnum</code> call on <code>NpgsqlConnection.GlobalTypeMapper</code> and the <code>HasPostgresEnum</code> call in <code>OnModelCreating</code> - can be removed.</p>
<p>If your application passes an NpgsqlDataSource to <code>UseNpgsql</code>, it also needs to add the <code>MapEnum</code> call as above; but the <code>MapEnum</code> call on <code>NpgsqlDataSourceBuilder</code> must also be kept.</p>
<p>See the <a href="../mapping/enum.html">enum documentation</a> for more information.</p>
<h2 id="contributors">Contributors</h2>
<p>A big thank you to all the following people who contributed to the 9.0 release!</p>
<h3 id="milestone-900"><a href="https://github.com/npgsql/efcore.pg/milestone/61?closed=1">Milestone 9.0.0</a></h3>
<table>
<thead>
<tr>
<th>Contributor</th>
<th>Assigned issues</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/roji">@roji</a></td>
<td><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A8.0.0+is%3Aclosed+assignee%3Aroji">34</a></td>
</tr>
<tr>
<td><a href="https://github.com/ChrisJollyAU">@ChrisJollyAU</a></td>
<td><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A8.0.0+is%3Aclosed+assignee%3AChrisJollyAU">1</a></td>
</tr>
<tr>
<td><a href="https://github.com/Timovzl">@Timovzl</a></td>
<td><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A8.0.0+is%3Aclosed+assignee%3ATimovzl">1</a></td>
</tr>
</tbody>
</table>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/npgsql/doc/blob/main/conceptual/EFCore.PG/release-notes/9.0.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          © Copyright 2024 The Npgsql Development Team
        </div>
      </div>
    </footer>
  </body>
</html>
