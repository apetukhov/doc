<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>7.0 Release Notes | Npgsql Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="7.0 Release Notes | Npgsql Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/npgsql/doc/blob/main/conceptual/EFCore.PG/release-notes/7.0.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../img/logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="70-release-notes">7.0 Release Notes</h1>

<h2 id="new-features">New features</h2>
<h3 id="executeupdate-and-executedelete">ExecuteUpdate and ExecuteDelete</h3>
<p>Support has been added for the new EF Core 7.0 <code>ExecuteUpdate</code> and <code>ExecuteDelete</code>, which allow expressing arbitrary, efficient updates via LINQ. See the EF <a href="https://learn.microsoft.com/ef/core/what-is-new/ef-core-7.0/whatsnew#executeupdate-and-executedelete-bulk-updates">What's new section</a> for documentation.</p>
<h3 id="support-for-dbdatasource">Support for DbDataSource</h3>
<p>Npgsql 7.0 introduced <a class="xref" href="../../doc/api/Npgsql.NpgsqlDataSource.html">NpgsqlDataSource</a>, a major improvement to how database connections and configuration are managed in System.Data. <a class="xref" href="../../doc/api/Npgsql.NpgsqlDataSource.html">NpgsqlDataSource</a> enabled rich new configuration APIs, which are also available when using the Npgsql EF provider:</p>
<pre><code class="lang-csharp">// Create a data source with the configuration you want:
var dataSourceBuilder = new NpgsqlDataSourceBuilder(builder.Configuration.GetConnectionString(&quot;MyContext&quot;));
dataSourceBuilder
    .UseLoggerFactory(loggerFactory) // Configure ADO.NET logging
    .UsePeriodicPasswordProvider(); // Automatically rotate the password periodically
await using var dataSource = dataSourceBuilder.Build();

// Pass your data source to the EF provider:
builder.Services.AddDbContext&lt;MyContext&gt;(options =&gt; options.UseNpgsql(dataSource);
</code></pre>
<p>Note that the data source configuration works at the Npgsql ADO.NET layer, and is distinct from EF-level configuration. More improvements are planned in 8.0, to make data source usage more streamlined, especially around type mapping plugins, enums, etc.</p>
<h3 id="extensive-support-for-aggregate-function-translation">Extensive support for aggregate function translation</h3>
<p>EF Core 7.0 added support for translating provider-specific aggregate functions, and EFCore.PG builds on top of that to translate most major aggregate functions that PostgreSQL supports. This unlocks support for:</p>
<ul>
<li><strong>string_agg</strong>: pack a column's values into a single string, with or without a delimiter.</li>
<li><strong>array_agg</strong>: pack a column's values into a PostgreSQL array. This can help with efficient fetching of dependent values, avoiding the so-called &quot;cartesian explosion&quot; problem.</li>
<li><strong>Statistical functions</strong>: standard deviation, variance and many others.</li>
<li><strong>Spatial functions</strong>: ST_Union, ST_Collect, ST_Extent and ST_ConvexHull.</li>
<li><strong>JSON functions</strong>: load values from the database as JSON documents with json_agg/jsonb_agg and json_object_agg/jsonb_object_agg.</li>
</ul>
<p>For the PostgreSQL documentation on aggregate functions, see <a href="https://www.postgresql.org/docs/current/functions-aggregate.html">this page</a>. The exact translations supported by the provider are documented in the <a href="../mapping/translations.html#aggregate-functions">translations page</a>.</p>
<h3 id="row-value-expressions">Row value expressions</h3>
<p>The provider now supports translations which make use of <em>row value expressions</em>, which are conceptually similar to tuples. Row values are particularly useful for implementing <em>keyset pagination</em>, which is much more efficient than the common, offset-base pagination. To learn more about pagination techniques, see <a href="https://learn.microsoft.com/ef/core/querying/pagination">this documentation page</a>.</p>
<p>Here's an example comparing two row values as an implementation of keyset pagination:</p>
<pre><code class="lang-csharp">var nextPage = context.Posts
    .OrderBy(b =&gt; b.Date)
    .ThenBy(b =&gt; b.PostId)
    .Where(b =&gt; EF.Functions.GreaterThan(
        ValueTuple.Create(b.Date, b.PostId),
        ValueTuple.Create(lastDate, lastId)))
    .Take(10)
    .ToList();
</code></pre>
<p>This generates the following SQL:</p>
<pre><code class="lang-sql">SELECT p.&quot;PostId&quot;, p.&quot;Date&quot;
FROM &quot;Posts&quot; AS p
WHERE (p.&quot;Date&quot;, p.&quot;PostId&quot;) &gt; (@__lastDate_1, @__lastId_2)
ORDER BY p.&quot;Date&quot;, p.&quot;PostId&quot;
LIMIT @__p_3
</code></pre>
<p>To the list of row value translations, see the <a href="../mapping/translations.html#row-value-comparisons">translations page</a>.</p>
<h3 id="other-new-features">Other new features</h3>
<ul>
<li>Support for PostgreSQL 15 non-distinct NULLs in unique indexes, causing unique constraint violations if a column contains multiple null values. <a href="../modeling/indexes.html#treating-nulls-as-non-distinct">See the documentation for more details</a>.</li>
<li>Stored procedure mappings: PostgreSQL support has been added for <em>stored procedure mapping</em>, which is a new feature in EF Core 7.0. See the EF <a href="https://learn.microsoft.com/ef/core/what-is-new/ef-core-7.0/whatsnew#stored-procedure-mapping">What's new section</a> for documentation. Note that PostgreSQL 14 or above is required to use this feature (for output parameters).</li>
</ul>
<h2 id="breaking-changes">Breaking changes</h2>
<p>Note: version 7.0 of the lower-level Npgsql ADO.NET driver, which is used by the EF provider, also has some breaking changes. It's recommended to read the <a href="../../doc/release-notes/7.0.html">release notes</a> for that as well.</p>
<h3 id="obsoleted-usexminasconcurrencytoken">Obsoleted UseXminAsConcurrencyToken</h3>
<p>Starting with version 7.0, concurrency token properties can be configured via the standard EF means, rather than the PostgreSQL-specific <code>UseXminAsConcurrencyToken</code>; simply configure any <code>uint</code> property with the <code>IsRowVersion()</code> Fluent API or the <code>[Timestamp]</code> Data Annotation. <a href="../modeling/concurrency.html">See the documentation for more details</a>.</p>
<h3 id="obsoleted-default-column-collations">Obsoleted default column collations</h3>
<p>Versions 6.0 and below had a mechanism that allowed defining a &quot;default column collation&quot;, which is applied individually to every text column by default; this differed from the database collation, which is applied once to the database at creation time. This mechanism was introduced because in PostgreSQL, the database collation is quite limited, and for example does not allow specifying non-deterministic collations (e.g. case-insensitive ones).</p>
<p>However, with the introduction of <a href="https://docs.microsoft.com/ef/core/modeling/bulk-configuration#pre-convention-configuration">pre-convention model configuration</a> in EF Core, it's now possible to use that generic mechanism for specifying the default collation. As a result, the Npgsql-specific mechanism has been obsoleted and will be removed in a future version.</p>
<p>Default column collations involve the following code:</p>
<pre><code class="lang-csharp">protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.UseDefaultColumnCollation(&quot;&lt;collation_name&gt;&quot;);
}
</code></pre>
<p>To switch to the standard EF Core API, replace the code above with the following:</p>
<pre><code class="lang-csharp">protected override void ConfigureConventions(ModelConfigurationBuilder configurationBuilder)
{
    configurationBuilder.Properties&lt;string&gt;().UseCollation(&quot;&lt;collation_name&gt;&quot;);
}
</code></pre>
<h2 id="contributors">Contributors</h2>
<p>A big thank you to all the following people who contributed to the 7.0 release!</p>
<h3 id="milestone-7011"><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A7.0.11">Milestone 7.0.11</a></h3>
<table>
<thead>
<tr>
<th>Contributor</th>
<th style="text-align: right;">Assigned issues</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/roji">@roji</a></td>
<td style="text-align: right;"><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A7.0.11+is%3Aclosed+assignee%3Aroji">1</a></td>
</tr>
</tbody>
</table>
<h3 id="milestone-704"><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A7.0.4">Milestone 7.0.4</a></h3>
<table>
<thead>
<tr>
<th>Contributor</th>
<th style="text-align: right;">Assigned issues</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/roji">@roji</a></td>
<td style="text-align: right;"><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A7.0.4+is%3Aclosed+assignee%3Aroji">7</a></td>
</tr>
</tbody>
</table>
<h3 id="milestone-703"><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A7.0.3">Milestone 7.0.3</a></h3>
<table>
<thead>
<tr>
<th>Contributor</th>
<th style="text-align: right;">Assigned issues</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/jhartmann123">@jhartmann123</a></td>
<td style="text-align: right;"><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A7.0.3+is%3Aclosed+assignee%3Ajhartmann123">1</a></td>
</tr>
<tr>
<td><a href="https://github.com/roji">@roji</a></td>
<td style="text-align: right;"><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A7.0.3+is%3Aclosed+assignee%3Aroji">1</a></td>
</tr>
</tbody>
</table>
<h3 id="milestone-701"><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A7.0.1">Milestone 7.0.1</a></h3>
<table>
<thead>
<tr>
<th>Contributor</th>
<th style="text-align: right;">Assigned issues</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/roji">@roji</a></td>
<td style="text-align: right;"><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A7.0.1+is%3Aclosed+assignee%3Aroji">3</a></td>
</tr>
</tbody>
</table>
<h3 id="milestone-700"><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A7.0.0">Milestone 7.0.0</a></h3>
<table>
<thead>
<tr>
<th>Contributor</th>
<th style="text-align: right;">Assigned issues</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/roji">@roji</a></td>
<td style="text-align: right;"><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A7.0.0+is%3Aclosed+assignee%3Aroji">35</a></td>
</tr>
<tr>
<td><a href="https://github.com/midgleyc">@midgleyc</a></td>
<td style="text-align: right;"><a href="https://github.com/Npgsql/efcore.pg/issues?q=is%3Aissue+milestone%3A7.0.0+is%3Aclosed+assignee%3Amidgleyc">1</a></td>
</tr>
</tbody>
</table>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/npgsql/doc/blob/main/conceptual/EFCore.PG/release-notes/7.0.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          © Copyright 2024 The Npgsql Development Team
        </div>
      </div>
    </footer>
  </body>
</html>
