<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Indexes | Npgsql Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Indexes | Npgsql Documentation ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/npgsql/doc/blob/main/conceptual/EFCore.PG/modeling/indexes.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="indexes">Indexes</h1>

<p>PostgreSQL and the Npgsql provider support the standard index modeling described in <a href="https://docs.microsoft.com/ef/core/modeling/indexes">the EF Core docs</a>. This page describes some supported PostgreSQL-specific features.</p>
<h2 id="covering-indexes-include">Covering indexes (INCLUDE)</h2>
<p>PostgreSQL supports <a href="https://paquier.xyz/postgresql-2/postgres-11-covering-indexes">covering indexes</a>, which allow you to include &quot;non-key&quot; columns in your indexes. This allows you to perform index-only scans and can provide a significant performance boost:</p>
<pre><code class="lang-c#">protected override void OnModelCreating(ModelBuilder modelBuilder)
    =&gt; modelBuilder.Entity&lt;Blog&gt;()
        .HasIndex(b =&gt; b.Id)
        .IncludeProperties(b =&gt; b.Name);
</code></pre>
<p>This will create an index for searching on <code>Id</code>, but containing also the column <code>Name</code>, so that reading the latter will not involve accessing the table. The SQL generated is as follows:</p>
<pre><code class="lang-sql">CREATE INDEX &quot;IX_Blog_Id&quot; ON blogs (&quot;Id&quot;) INCLUDE (&quot;Name&quot;);
</code></pre>
<h2 id="treating-nulls-as-non-distinct">Treating nulls as non-distinct</h2>
<div class="NOTE">
<h5>Note</h5>
<p>This feature was introduced in version 7.0, and is available starting with PostgreSQL 15.</p>
</div>
<p>By default, when you create a unique index, PostgreSQL treats null values as distinct; this means that a unique index can contain multiple null values in a column. When creating an index, you can also instruct PostgreSQL that nulls should be treated as <em>non-distinct</em>; this causes a unique constraint violation to be raised if a column contains multiple null values:</p>
<pre><code class="lang-c#">protected override void OnModelCreating(ModelBuilder modelBuilder)
    =&gt; modelBuilder.Entity&lt;Blog&gt;()
        .IsUnique()
        .AreNullsDistinct(false);
</code></pre>
<h2 id="index-methods">Index methods</h2>
<p>PostgreSQL supports a number of <em>index methods</em>, or <em>types</em>. These are specified at index creation time via the <code>USING &lt;method&gt;</code> clause, see the <a href="https://www.postgresql.org/docs/current/static/sql-createindex.html">PostgreSQL docs for <code>CREATE INDEX</code></a> and <a href="https://www.postgresql.org/docs/current/static/indexes-types.html">this page</a> for information on the different types.</p>
<p>The Npgsql EF Core provider allows you to specify the index method to be used by calling <code>HasMethod()</code> on your index in your context's <code>OnModelCreating</code> method:</p>
<pre><code class="lang-c#">protected override void OnModelCreating(ModelBuilder modelBuilder)
    =&gt; modelBuilder.Entity&lt;Blog&gt;()
        .HasIndex(b =&gt; b.Url)
        .HasMethod(&quot;gin&quot;);
</code></pre>
<h2 id="index-operator-classes">Index operator classes</h2>
<p>PostgreSQL allows you to specify <a href="https://www.postgresql.org/docs/current/indexes-opclass.html">operator classes on your indexes</a>, to allow tweaking how the index should work. Use the following code to specify an operator class:</p>
<pre><code class="lang-c#">protected override void OnConfiguring(DbContextOptionsBuilder builder)
    =&gt; modelBuilder.Entity&lt;Blog&gt;()
        .HasIndex(b =&gt; new { b.Id, b.Name })
        .HasOperators(null, &quot;text_pattern_ops&quot;);
</code></pre>
<p>Note that each operator class is used for the corresponding index column, by order. In the example above, the <code>text_pattern_ops</code> class will be used for the <code>Name</code> column, while the <code>Id</code> column will use the default class (unspecified), producing the following SQL:</p>
<pre><code class="lang-sql">CREATE INDEX &quot;IX_blogs_Id_Name&quot; ON blogs (&quot;Id&quot;, &quot;Name&quot; text_pattern_ops);
</code></pre>
<h2 id="storage-parameters">Storage parameters</h2>
<p>PostgreSQL allows configuring indexes with <em>storage parameters</em>, which can tweak their behaviors in various ways; which storage parameters are available depends on the chosen index method. <a href="https://www.postgresql.org/docs/current/sql-createindex.html#SQL-CREATEINDEX-STORAGE-PARAMETERS">See the PostgreSQL documentation</a> for more information.</p>
<p>To configure a storage parameter on an index, use the following code:</p>
<pre><code class="lang-c#">protected override void OnModelCreating(ModelBuilder modelBuilder)
    =&gt; modelBuilder.Entity&lt;Blog&gt;()
        .HasIndex(b =&gt; b.Url)
        .HasStorageParameter(&quot;fillfactor&quot;, 70);
</code></pre>
<h2 id="creating-indexes-concurrently">Creating indexes concurrently</h2>
<p>Creating an index can interfere with regular operation of a database. Normally PostgreSQL locks the table to be indexed against writes and performs the entire index build with a single scan of the table. Other transactions can still read the table, but if they try to insert, update, or delete rows in the table they will block until the index build is finished. This could have a severe effect if the system is a live production database. Very large tables can take many hours to be indexed, and even for smaller tables, an index build can lock out writers for periods that are unacceptably long for a production system.</p>
<p>The EF provider allows you to specify that an index should be created <em>concurrently</em>, partially mitigating the above issues:</p>
<pre><code class="lang-c#">protected override void OnModelCreating(ModelBuilder modelBuilder)
    =&gt; modelBuilder.Entity&lt;Blog&gt;()
        .HasIndex(b =&gt; b.Url)
        .IsCreatedConcurrently();
</code></pre>
<div class="CAUTION">
<h5>Caution</h5>
<p>Do not enable this feature before reading the <a href="https://www.postgresql.org/docs/current/sql-createindex.html#SQL-CREATEINDEX-CONCURRENTLY">PostgreSQL documentation</a> and understanding the full implications of concurrent index creation.</p>
</div>
<div class="NOTE">
<h5>Note</h5>
<p>Prior to version 5.0, <code>IsCreatedConcurrently</code> erroneously defaulted to <code>false</code> - explicitly pass <code>true</code> to configure the index for concurrent creation</p>
</div>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/npgsql/doc/blob/main/conceptual/EFCore.PG/modeling/indexes.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          © Copyright 2024 The Npgsql Development Team
        </div>
      </div>
    </footer>
  </body>
</html>
